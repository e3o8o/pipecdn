#!/bin/bash

# Pipe PoP Node Management Script
# This script provides a convenient wrapper around the pipe-pop binary

# Colors for output
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

# Function to print colored messages
print_message() {
    echo -e "${GREEN}[INFO]${NC} $1"
}

print_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

print_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# Check if the binary exists
if [ ! -f "bin/pipe-pop" ]; then
    print_error "Pipe PoP binary not found. Please run setup.sh first."
    exit 1
fi

# Function to show help
show_help() {
    echo "Pipe PoP Node Management Script"
    echo "Usage: ./pop [OPTION]"
    echo ""
    echo "Options:"
    echo "  --status                Check node status and reputation"
    echo "  --check-update          Check for available updates"
    echo "  --update                Update to the latest version"
    echo "  --gen-referral-route    Generate a referral code"
    echo "  --points-route          Check points and rewards"
    echo "  --monitor               Monitor node status"
    echo "  --backup                Create a backup"
    echo "  --restart               Restart the node service"
    echo "  --logs                  View service logs"
    echo "  --help                  Show this help message"
    echo ""
    echo "Examples:"
    echo "  ./pop --status          Check node status"
    echo "  ./pop --update          Update to the latest version"
}

# Main execution
case "$1" in
    --status)
        print_message "Checking node status..."
        ./bin/pipe-pop --status
        ;;
    --check-update)
        print_message "Checking for updates..."
        ./bin/pipe-pop --check-update
        ;;
    --update)
        print_message "Updating to the latest version..."
        if [ "$EUID" -ne 0 ]; then
            print_error "This command must be run as root (with sudo)"
            exit 1
        fi
        ./bin/pipe-pop --update
        ;;
    --gen-referral-route)
        print_message "Generating referral code..."
        ./bin/pipe-pop --gen-referral-route
        ;;
    --points-route)
        print_message "Checking points and rewards..."
        ./bin/pipe-pop --points-route
        ;;
    --monitor)
        print_message "Monitoring node status..."
        ./monitor.sh
        ;;
    --backup)
        print_message "Creating backup..."
        ./backup.sh
        ;;
    --restart)
        print_message "Restarting node service..."
        if [ "$EUID" -ne 0 ]; then
            print_error "This command must be run as root (with sudo)"
            exit 1
        fi
        sudo systemctl restart pipe-pop.service
        print_message "Service restarted."
        ;;
    --logs)
        print_message "Viewing service logs..."
        journalctl -u pipe-pop.service -n 50
        ;;
    --help|*)
        show_help
        ;;
esac

exit 0 